{% set title = category.title %}
{% set entries =  craft.entries({
    type: 'chapter',
    relatedTo: category,
    order: 'chapterLevel'
    })
%}
{% set pageClass = 'story' %}
{% set path = craft.request.getUrl() %}

{% extends '_layout' %}

{% block content %}

{#  <pre>
    {% for entry in category.storyTimeline.first().years %}
        {{ dump(year.description) }}
    {% endfor %}
 </pre> #}

<article class="story">

{% for entry in entries %}
    <section class="article-item">

    <header class="article-hdr">

        <h2>LEVEL {{ entry.chapterLevel }}</h2>
        <h1>{{ entry.title }}</h1>

    </header>

    <div class="article-txt">

        {% for block in entry.chapterBody %}

            {% switch block.type %}

                {% case 'text' %}

                    {{ block.text }}

                {% case 'quote' %}
                    <blockquote class="quote {{ block.align }}-quote">
                        {{ block.quote }}
                    </blockquote>

                {% case 'image' %}

{#                 {% set image = block.image.first() %}
                <figure class="{{ block.align }}-image">
                    <img src="{{ image.getUrl() }}" alt="{{ image.title }}">
                    <figcaption>{{ block.caption }}</figcaption>
                </figure> #}

            {% endswitch %}

        {% endfor %}
        </div>
        {# end article-txt #}
        <div class="aside-container">
        {% for aside in entry.sidenotes %}

            {% if aside.type == 'aside' %}
                <input type="radio" class="aside-input" name="aside-input-{{ entry.slug }}" id="aside-{{loop.index}}" {% if loop.first %}checked{% endif %}>
                <aside class="margin-aside">
                    {% if aside.asideImage | length %}
                        <div class="cropper">
                        <img src="{{ aside.asideImage.first().getUrl() }}" {# style="background-image: url({{ aside.asideImage.first().getUrl() }})" #} alt="{{ aside.title }}">
                        </div>
                    {% endif %}
                    <h1>{{ aside.title }}</h1>
                    <blockquote>{{ aside.quote }}</blockquote>
                    <p>{{ aside.body }}</p>

                    {% if aside.asideCitation | length %}
                        <small>citation goes here</small>
                    {% endif %}
                    {% if aside.chapters | length %}
                        <ul class="aside-links">
                        <h2>Read more about this:</h2>
                        {% for chapter in aside.chapters %}
                            <a href="{{ chapter.getUrl() }}">{{ chapter.title }}</a><button class="aside-link-button"></button>
                        {% endfor %}
                        </ul>
                    {% endif %}
                    <hr>
                </aside>
                {% endif %}
            {% endfor %}
        </div>
        <ul class="aside-list">
            <h2>Notes:</h2>
            {% for aside in entry.sidenotes %}
            <label for="aside-{{loop.index}}" class="{% if loop.first %}active{% endif %}"><li>{{ aside.title }}</li></label>
            {% endfor %}
        </ul>
    </section>
    {# end section article-item #}
{% endfor %}

</article>


{% endblock %}

{% block timeline %}

    {% include 'timeline.twig' %}

{% endblock %}


